root@redmine:~# cat  /var/lib/letsencrypt/renew-site.sh
#!/bin/bash

set -e
set -u
set -o pipefail

/var/lib/letsencrypt/letsencrypt/letsencrypt-auto \
  --text \
  --agree-tos \
  --renew-by-default \
  --webroot  \
  --webroot-path /var/www/letsencrypt/ \
  -m 'hostmaster@galeoconsulting.com' \
  certonly -d "${1}"

root@redmine:~#





server {
    listen      80;
    server_name xxx xxx.yyy.com;

    location /.well-known/acme-challenge {
      root /var/www/letsencrypt/;
    }

    location / {
      return 301 https://xxx.yyy.com;
    }

    access_log /var/log/nginx/xxx_access.log combined buffer=32k flush=5m;
    error_log /var/log/nginx/xxx_error.log warn;
}


server {
    listen      443 ssl;
    server_name xxx xxx.yyy.com;

   ssl on;
    ssl_certificate /etc/letsencrypt/live/xxx.yyy.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/xxx.yyy.com/privkey.pem;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA;
    # ssl_session_cache shared:SSL:50m;
    # ssl_dhparam /etc/nginx/certs/xxx.yyy.com_ssl_dhparam.pem;
    ssl_prefer_server_ciphers on;
...
}



20 7    2 * *   root    cd /tmp/ && /var/lib/letsencrypt/renew-site.sh xxx.yyy.com && service nginx reload
